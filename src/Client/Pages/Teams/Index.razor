@page "/teams"
@inject ApiClient Api
@inject IDialogService DialogService
@inject NavigationManager Nav

<h1>Raid Teams</h1>

<MudPaper>
    <ApiExecutor Operation="Api.Teams.GetAllTeamNames" Context="teamNames" @ref="_executor">
        <MudList Clickable="true">
            <MudListSubheader Class="d-flex align-baseline">
                <MudTooltip Text="Refresh Teams">
                    <MudIconButton OnClick="() => _executor?.RestartAsync() ?? Task.CompletedTask" Icon="@Icons.Material.Filled.Refresh" />
                </MudTooltip>

                <AuthorizeView Roles="@AppRoles.Administrator">
                    <MudTooltip Text="Add Team">
                        <MudFab OnClick="CreateClicked" Color="Color.Primary" Icon="@Icons.Material.Filled.Add" />
                    </MudTooltip>
                </AuthorizeView>
            </MudListSubheader>
            @foreach (var team in teamNames)
            {
                <MudListItem Href="@("teams/" + team)">@team</MudListItem>
            }
        </MudList>
    </ApiExecutor>
</MudPaper>

@code {
    private IApiExecutor? _executor;

    private async Task CreateClicked()
    {
        var dto = await DialogService.ShowAsync<Create, TeamDto>("Create Team");

        if (dto is not null)
        {
            Nav.NavigateTo("teams/" + dto.Id);
        }
    }
}
