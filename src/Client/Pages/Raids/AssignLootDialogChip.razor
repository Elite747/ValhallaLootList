@inject ApiClient Api

<MudTooltip Text="@Context.Message">
    <TooltipContent>
        @if (Context.Rto)
        {
            <div><b>RTO</b></div>
        }
        @if (Disenchant)
        {
            <span>Disenchant</span>
        }
        else if (Context.Message.Length > 0)
        {
            <span>@Context.Message</span>
        }
        else
        {
            <div>
                Rank @Context.Rank
            </div>
            @foreach (var bonus in Context.Bonuses)
            {
                <div>
                    <PriorityBonusDisplay Bonus="bonus" />
                </div>
            }
        }
    </TooltipContent>
    <ChildContent>
        <CharacterChip Character="Context.Character" OnClick="OnClick" Disabled="Context.Disabled">
            <div class="d-flex align-center">
                @Context.Character.Name
                @if (Context.Rto || (Context.Message.Length > 0 && !Disenchant))
                {
                    <MudIcon Size="Size.Medium" Icon="@Icons.Material.Filled.Error" Color="Context.Rto ? Color.Info : Color.Error" Style="margin-left: 4px; margin-right: -12px" />
                }
            </div>
        </CharacterChip>
    </ChildContent>
</MudTooltip>

@code {
    [Parameter] public AssignEntryContext Context { get; set; } = null!;
    [Parameter] public bool Disenchant { get; set; } = false;
    [CascadingParameter] MudDialogInstance Dialog { get; set; } = null!;

    protected override void OnParametersSet()
    {
        if (Context is null) throw new ArgumentNullException(nameof(Context));
        if (Dialog is null) throw new ArgumentNullException(nameof(Dialog));
    }

    private void OnClick()
    {
        Dialog.Close(DialogResult.Ok(new AssignEntryResponse
        {
            CharacterId = Context.Character.Id,
            Disenchant = Disenchant
        }));
    }
}
